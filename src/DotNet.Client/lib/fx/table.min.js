!function(t){"use strict";var e=function(){function e(e){var n=t.Event("loading");if(e.$element.triggerHandler(n,[this]),n.result!==!1&&0!=e.options.onBeforeLoad.call(e.element,e.options)){var i=t.extend({},{page:e.options.page,order:e.options.order,dir:e.options.dir},e.options.params);t.ajax({url:e.options.url,type:e.options.type,data:i,beforeSend:function(){fx.loadMask.show(e.options)},success:function(t){fx.loadMask.hide(e.options),o(e,t)},error:function(t){fx.loadMask.hide(e.options),e.$element.empty(),fx.ajaxFail(t,e.$element)}})}}function o(o,i){o.$element.empty(),o.$element.append(i),o.$table=o.$element.find("table"),o.$paginate=o.$element.find(".paginate-area"),o.$checkboxs=o.$table.find("tbody .checkbox-check"),o.$element.find('[data-toggle="tooltip"]').tooltip(),o.$checkboxs.on("change",function(){var e=t(this).prop("checked");e?t(this).closest("tr").addClass("warning"):t(this).closest("tr").removeClass("warning")}),o.$table.find("thead .checkbox-check").on("change",function(){var e=t(this).prop("checked");o.$checkboxs.each(function(){e?(t(this).prop("checked",!0),t(this).closest("tr").addClass("warning")):(t(this).prop("checked",!1),t(this).closest("tr").removeClass("warning"))})}),o.$paginate.find("ul>li:not(.active,.disabled)>a").on("click",function(){o.options.page=t(this).data("page"),e(o)}).css("cursor","pointer"),o.$table.find("thead>tr>th[data-order]").each(function(){var e=t(this).data("order");o.options.order===e&&("asc"===o.options.dir?t(this).append(' <i class="fa fa-long-arrow-down" title="升序排序"></i>'):"desc"===o.options.dir&&t(this).append(' <i class="fa fa-long-arrow-up" title="倒序排序"></i>'))}).on("click",function(){o.options.order=t(this).data("order"),o.options.dir&&"asc"===o.options.dir?o.options.dir="desc":o.options.dir="asc",e(o)}).css("cursor","pointer"),n(o),o.$element.triggerHandler("loaded",[this]),o.options.onAfterLoad.call(o.element,o.options)}function n(t){if(1==t.options.alert){var e=t.$table.find("tbody tr").length>0;0==e&&(t.$element.empty(),t.$element.showWarning("没有查询到数据！"))}}function i(e,o){this.options=o,this.element=e,this.$element=t(e),this.$table=null,this.$paginate=null,this.$checkboxs=null,this.init()}return i.prototype.init=function(){this.options.loadMaskTarget||(this.options.loadMaskTarget=this.element),this.options.params||(this.options.params={}),this.initSearchForm(),1==this.options.autoLoad&&(0==this.$element.find("table").length?e(this):o(this,this.$element.html()))},i.prototype.initSearchForm=function(){var e=this;if(e.options.form){var o=t(this.options.form);o.find(":submit:first").on("click",function(){var t=fx.serializeForm(o);return e.search(t),!1})}},i.prototype.setOptions=function(e){"object"==typeof e&&t.extend(this.options,e)},i.prototype.getSelectedIds=function(){var t=[];return this.$checkboxs.each(function(){this.checked&&t.push(this.value)}),t},i.prototype.sort=function(t,o){o||(o="asc"),this.options.order=t,this.options.dir=o,e(this)},i.prototype.search=function(o){this.options.page=1,t.extend(this.options.params,o),e(this)},i.prototype.reload=function(o){t.extend(this.options.params,o),e(this)},i.prototype.clearRows=function(){this.$table.find("tbody").empty(),this.$paginate.empty(),n(this)},i.prototype.getRowCount=function(){return this.$table?this.$table.find("tbody tr").length:0},i}();t.fn.uitable=function(o){return this.each(function(){var n=t(this),i=n.data("uitable");if(i)i.setOptions(o);else{var a=t.extend({},t.fn.uitable.defaults,t.fn.uitable.parseOptions(n),o);i=new e(this,a),n.data("uitable",i)}}),t(this).data("uitable")},t.fn.uitable.parseOptions=function(t){return fx.convertOptionToObj(t,["params"]),fx.convertOptionToFunc(t,["onBeforeLoad","onAfterLoad"]),t.data()},t.fn.uitable.defaults=t.extend({},fx.loadMask.defaults,{container:fx.module,loadMaskMessage:"正在加载数据,请稍等...",autoLoad:!0,alert:!0,type:"post",url:null,page:1,order:null,dir:null,form:".search-table",onBeforeLoad:function(t){},onAfterLoad:function(t){}}),t(document).on(fx.initUIEventName,function(e){t(e.target).find(".uitable").uitable()})}(jQuery);