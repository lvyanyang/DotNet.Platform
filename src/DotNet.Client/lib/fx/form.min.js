!function(e){"use strict";var t=function(){function t(t,n){this.element=t,this.$element=e(t),this.options=n,this.init()}var n=function(t){var n={};t.$element.find("input[type=checkbox]").each(function(){if(e(this).prop("checked")!==!0){var t=e(this).attr("name");n[t]=e(this).prop("checked")}}),e.extend(n,t.options.onData.call(t.element,t.options));var i=e.extend({},t.options,{data:n,error:function(e){fx.loadMask.hide(t.options),fx.ajaxFailAlert(e)},success:function(e){fx.loadMask.hide(t.options),t.$element.triggerHandler("submitsuccess",[e]),t.options.onSubmitSuccess.call(t.element,e,t.options)}});fx.loadMask.show(t.options),t.$element.ajaxSubmit(i)},i=function(t){var i=e(t.options.container),o={messages:{},rules:{},invalidHandler:function(){t.successEl&&i.find(t.successEl).hide(),t.errorEl&&i.find(t.errorEl).show(),1==t.options.modal?t.$element.closest(".modal").animate({scrollTop:0},"slow"):e(fx.module).animate({scrollTop:0},"slow")},submitHandler:function(){t.successEl&&i.find(t.successEl).show(),t.errorEl&&i.find(t.errorEl).hide(),0!=t.options.onBeforeSubmit.call(t.element,t.options)&&n(t)}};t.$element.find("[data-validate]").each(function(){var t=e(this).attr("name"),n=e(this).data("validate"),i=e(this).data("validateMessage");n&&(o.rules[t]=n.toObject()),i&&(o.messages[t]=i.toObject())}),t.$element.validate(o),e().iCheck&&t.$element.find(".uicheck").on("ifToggled",function(n){t.$element.validate().element(e(this))}),e().select2&&t.$element.find(".uiselect").on("change",function(){t.$element.validate().element(e(this))}),e().clockpicker&&t.$element.find(".uiclock").clockpicker().find("input").change(function(){t.$element.validate().element(e(this))}),e().timepicker&&t.$element.find(".uitime").timepicker().on("changeTime.timepicker",function(n){t.$element.validate().element(e(this))}),e().datepicker&&t.$element.find(".uidate").datepicker().on("changeDate",function(n){e(this).datepicker("hide"),t.$element.validate().element(e(this).find(".form-control"))}),e().datetimepicker&&t.$element.find(".uidatetime").datetimepicker().on("changeDate",function(n){t.$element.validate().element(e(this))})};return t.prototype.init=function(){this.options.container||(this.options.container=this.element),this.options.modal&&(this.options.container=this.$element.getFormModal()[0]),this.options.loadMaskTarget||(this.options.modal?this.options.loadMaskTarget=this.$element.closest(".modal-content"):this.options.loadMaskTarget=this.options.container),i(this)},t.prototype.setOptions=function(t){"object"==typeof t&&e.extend(this.options,t)},t.prototype.formSerialize=function(){return $element.formSerialize()},t.prototype.resetForm=function(){$element.resetForm()},t.prototype.clearForm=function(){$element.clearForm()},t}();e.fn.uiform=function(n){return this.each(function(){var i=e(this),o=i.data("uiform");if(o)o.setOptions(n);else{var s=e.extend({},e.fn.uiform.defaults,e.fn.uiform.parseOptions(i),n);o=new t(this,s),i.data("uiform",o)}}),e(this).data("uiform")},e.fn.uiform.parseOptions=function(e){return fx.convertOptionToFunc(e,["onData","onBeforeSubmit","onSubmitSuccess"]),e.data()},e.fn.uiform.defaults=e.extend({},fx.loadMask.defaults,{container:null,loadMaskMessage:"正在提交,请稍等...",modal:!1,errorEl:null,successEl:null,onData:function(e){return{}},onSubmitSuccess:function(e,t){},onBeforeSubmit:function(e){}}),e().validator&&e.validator.setDefaults({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:":hidden",errorPlacement:function(e,t){t.parent(".input-group").size()>0?e.insertAfter(t.parent(".input-group")):t.attr("data-error-container")?e.appendTo(t.attr("data-error-container")):t.parents(".icheck-list").size()>0?e.appendTo(t.parents(".icheck-list")):t.parents(".icheck-inline").size()>0?e.appendTo(t.parents(".icheck-inline")):t.parents(".radio-list").size()>0?e.appendTo(t.parents(".radio-list")):t.parents(".iradio-inline").size()>0?e.appendTo(t.parents(".iradio-inline")):t.is(".uiselect")?e.appendTo(t.parent()):t.is(".uifileupload")?e.appendTo(t.closest(".file-input")):e.insertAfter(t)},highlight:function(t){e(t).closest(".form-group").addClass("has-error")},unhighlight:function(t){e(t).closest(".form-group").removeClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()}}),e(document).on(fx.initUIEventName,function(t){e(t.target).find(".uiform").uiform()})}(jQuery);