!function(o){"use strict";var t=function(){function t(t,e){this.element=t,this.$element=o(t),this.options=e,this.init()}return t.prototype.init=function(){this.options.loadMaskTarget||(this.options.loadMaskTarget=fx.module)},t.prototype.setOptions=function(t){"object"==typeof t&&o.extend(this.options,t)},t.prototype.show=function(){var t=this;if(t.options.data||(t.options.data={}),0==t.options.onBeforeShow.call(t.element,t.options))return void t.$element.remove();var e=o.Event("beforeshow");if(t.$element.triggerHandler(e,[t]),0==e.result)return void t.$element.remove();var n="",a="";1==t.options.animate&&(n="fade "),"sm"==t.options.size?a="modal-sm":"lg"==t.options.size?a="modal-lg":"full"==t.options.size?a="modal-full":"big"==t.options.size&&(a="modal-big"),t.options["class"]&&(n+=t.options["class"]);var i='<div class="modal '+n+'" aria-hidden="true"  role="dialog" data-backdrop="'+t.options.backdrop+'">    <div class="modal-dialog '+a+' ">        <div class="modal-content">        </div>    </div></div>';1==t.options.autoHead&&t.$element.append(i),fx.loadMask.show(t.options);var l=function(e){1==t.options.autoHead?(t.$modal=t.$element.find(".modal"),t.$modal.find(".modal-content").empty().html(e)):(t.$element.empty().html(e),t.$modal=t.$element.find(".modal")),t.$modal.onAfterInitUI(function(){fx.loadMask.hide(t.options),t.options.onAfterShow.call(t.element,t.options),t.$element.triggerHandler(o.Event("aftershow"),[t])}),t.$modal.initUI(),t.$modal.on("hidden.bs.modal",function(){t.options.onBeforeClose.call(t.element,t.options),o().datetimepicker&&t.$element.find(".uidatetime").datetimepicker("remove"),t.$element.remove(),t.options.onAfterClose.call(t.element,t.options)}),t.$modal.modal("show")};o.ajax({url:t.options.url,data:o.extend({},t.options.data,t.options.onData.call(t.element,t.options)),type:"get",cache:!1,dataType:"html"}).done(l).fail(function(o){fx.loadMask.hide(t.options),fx.ajaxFailAlert(o)})},t.prototype.close=function(){this.$modal.modal("hide")},t}();o.fn.uimodal=function(e){return this.each(function(){var n=o(this),a=n.data("uimodal");if(a)a.setOptions(e);else{var i=o.extend({},o.fn.uimodal.defaults,e);a=new t(this,i),n.data("uimodal",a)}}),o(this).data("uimodal")},o.fn.uimodal.parseOptions=function(o){return fx.convertOptionToObj(o,["data"]),fx.convertOptionToFunc(o,["onData","onBeforeShow","onAfterShow","onBeforeClose","onAfterClose"]),o.data()},o.fn.uimodal.defaults=o.extend({},fx.loadMask.defaults,{container:fx.module,autoHead:!0,modalId:null,loadMaskMessage:"正在加载,请稍等...",animate:!0,backdrop:"static",url:null,size:null,onData:function(){return{}},onBeforeShow:function(){},onAfterShow:function(){},onBeforeClose:function(){},onAfterClose:function(){}}),o(document).on("click.fx.modal",".uimodal",function(){var t=o(this),e=t.data("container")||fx.module,n=t.data("modalId"),a="";n&&(a='id="'+n+'"');var i=o("<div "+a+' class="uimodal-container"></div>').appendTo(o(e)).uimodal(o.fn.uimodal.parseOptions(t));return t.data("uimodal",i),i.show(),!1})}(jQuery);